<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>쇼핑백 - LALA BOUTIQUE</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300&family=Noto+Sans+KR:wght@100;300;400&display=swap" rel="stylesheet">
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { padding: 60px; font-family: 'Noto Sans KR', sans-serif; transition: opacity 0.6s; color: #111; }
        .title { font-family: 'Cormorant Garamond', serif; text-align: center; letter-spacing: 15px; font-size: 30px; margin-bottom: 60px; text-transform: uppercase; }
        
        .container { max-width: 900px; margin: 0 auto; }
        .cart-utils { display: flex; justify-content: space-between; align-items: center; padding-bottom: 15px; border-bottom: 2px solid #111; font-size: 12px; margin-bottom: 20px; }
        .item-row { display: flex; align-items: center; padding: 25px 0; border-bottom: 1px solid #eee; gap: 30px; }
        .check-box { width: 16px; height: 16px; cursor: pointer; accent-color: #111; }
        .thumb { width: 90px; aspect-ratio: 9/16; object-fit: cover; background:#f9f9f9; }
        .info { flex: 1; }
        .qty-control { display: flex; align-items: center; gap: 10px; margin-top: 10px; }
        .qty-btn { width: 22px; height: 22px; border: 1px solid #ddd; background: #fff; cursor: pointer; font-size: 14px; }
        .qty-num { font-size: 13px; min-width: 25px; text-align: center; }
        
        .total-box { margin-top: 40px; text-align: right; font-size: 22px; border-top: 2px solid #111; padding-top: 25px; letter-spacing: 1px; }
        .btn-area { display: flex; gap: 10px; justify-content: center; margin-top: 50px; }
        .btn { border: 1px solid #111; background: none; padding: 15px 35px; cursor: pointer; font-size: 11px; letter-spacing: 2px; transition: 0.3s; }
        .btn-black { background: #111; color: #fff; }

        #order-form { display: none; margin-top: 80px; padding-top: 60px; border-top: 1px double #ddd; padding-bottom: 100px; }
        .form-group { margin-bottom: 25px; }
        .form-label { font-size: 10px; color: #888; letter-spacing: 1px; text-transform: uppercase; margin-bottom: 8px; display: block; }
        .lala-input { width: 100%; height: 45px; border: none; border-bottom: 1px solid #ddd; font-size: 14px; outline: none; transition: 0.3s; }
        .lala-input:focus { border-bottom: 1px solid #111; }
        .addr-btn { background: #111; color: #fff; border: none; font-size: 11px; padding: 5px 15px; cursor: pointer; margin-left: 10px; }
    </style>
</head>
<body>

    <h1 class="title">Shopping Bag</h1>

    <div class="container">
        <div class="cart-utils">
            <div>
                <input type="checkbox" id="all-check" class="check-box" onclick="toggleAll(this.checked)" checked>
                <label for="all-check" style="margin-left:5px; cursor:pointer;">전체 선택</label>
            </div>
            <button style="border:none; background:none; color:#999; cursor:pointer; font-size:11px; text-decoration:underline;" onclick="deleteSelected()">선택 삭제</button>
        </div>

        <div id="content"></div>

        <div class="total-box">
            <span style="font-size:12px; color:#888; margin-right:20px;">총 주문 금액</span>
            ₩ <span id="total-p">0</span>
        </div>

        <div class="btn-area">
            <button class="btn" onclick="location.href='homepage.html'">쇼핑 계속하기</button>
            <button class="btn btn-black" onclick="showOrderForm()">주문하기</button>
        </div>

        <div id="order-form">
            <h2 class="title" style="font-size:20px; margin-bottom:40px;">배송 정보 입력</h2>
            <div class="form-group">
                <label class="form-label">받으시는 분</label>
                <input type="text" id="order-name" class="lala-input" placeholder="성함을 입력해주세요.">
            </div>
            <div class="form-group">
                <label class="form-label">연락처</label>
                <input type="text" id="order-tel" class="lala-input" placeholder="010-0000-0000">
            </div>
            <div class="form-group" style="display:flex; align-items: flex-end;">
                <div style="flex:1;">
                    <label class="form-label">주소</label>
                    <input type="text" id="zip-code" class="lala-input" placeholder="우편번호" readonly>
                </div>
                <button class="addr-btn" onclick="searchAddr()">주소 찾기</button>
            </div>
            <input type="text" id="base-addr" class="lala-input" style="margin-bottom:15px;" placeholder="기본 주소" readonly>
            <input type="text" id="detail-addr" class="lala-input" placeholder="상세 주소를 입력해주세요.">
            
            <button class="btn btn-black" style="width:100%; margin-top:40px; height:60px;" onclick="finalOrder()">최종 결제하기</button>
        </div>
    </div>

    <script>
        let list = JSON.parse(localStorage.getItem('c_l')) || [];

        /**
         * 장바구니 리스트 렌더링
         */
        function render() {
            const cont = document.getElementById('content');
            let total = 0;
            cont.innerHTML = list.length ? "" : "<p style='text-align:center; padding:80px 0; color:#bbb; font-size:13px;'>장바구니에 담긴 상품이 없습니다.</p>";

            list.forEach((it, i) => {
                if(!it.qty) it.qty = 1; 
                total += (it.p * it.qty);

                cont.innerHTML += `
                <div class="item-row">
                    <input type="checkbox" class="check-box item-check" checked>
                    <img src="${it.img}" class="thumb" onerror="this.src='https://via.placeholder.com/90x160?text=LALA'">
                    <div class="info">
                        <h3 style="font-size:14px; font-weight:400;">${it.n}</h3>
                        <p style="color:#999; font-size:11px; margin:5px 0;">에센셜 컬렉션</p>
                        <strong style="font-size:13px;">₩ ${it.p.toLocaleString()}</strong>
                        <div class="qty-control">
                            <button class="qty-btn" onclick="changeQty(${i}, -1)">-</button>
                            <span class="qty-num">${it.qty}</span>
                            <button class="qty-btn" onclick="changeQty(${i}, 1)">+</button>
                        </div>
                    </div>
                    <button style="border:none; background:none; font-size:11px; color:#ccc; cursor:pointer; text-decoration:underline;" onclick="del(${i})">삭제</button>
                </div>`;
            });
            document.getElementById('total-p').innerText = total.toLocaleString();
        }

        function changeQty(index, gap) {
            list[index].qty += gap;
            if (list[index].qty < 1) list[index].qty = 1;
            saveAndRender();
        }

        function toggleAll(checked) {
            document.querySelectorAll('.item-check').forEach(cb => cb.checked = checked);
        }

        function deleteSelected() {
            const checks = document.querySelectorAll('.item-check');
            for (let i = checks.length - 1; i >= 0; i--) {
                if (checks[i].checked) list.splice(i, 1);
            }
            saveAndRender();
        }

        function del(i) {
            if(confirm("상품을 삭제하시겠습니까?")) {
                list.splice(i, 1);
                saveAndRender();
            }
        }

        function saveAndRender() {
            localStorage.setItem('c_l', JSON.stringify(list));
            render();
        }

        /**
         * 주문 폼 표시
         */
        function showOrderForm() {
            if(list.length === 0) { alert("주문할 상품이 없습니다."); return; }
            document.getElementById('order-form').style.display = 'block';
            window.scrollTo({ top: document.getElementById('order-form').offsetTop, behavior: 'smooth' });
        }

        /**
         * 주소 검색 (카카오 API)
         */
        function searchAddr() {
            new daum.Postcode({
                oncomplete: function(data) {
                    document.getElementById('zip-code').value = data.zonecode;
                    document.getElementById('base-addr').value = data.roadAddress;
                    document.getElementById('detail-addr').focus();
                }
            }).open();
        }

        /**
         * 최종 주문 처리
         */
        function finalOrder() {
            const name = document.getElementById('order-name').value;
            const tel = document.getElementById('order-tel').value;
            const addr = document.getElementById('detail-addr').value;

            if(!name || !tel || !addr) { 
                alert("배송 정보를 모두 정확히 입력해주세요."); 
                return; 
            }

            alert(name + "님, 주문이 성공적으로 완료되었습니다.\n감사합니다!");
            localStorage.removeItem('c_l'); // 장바구니 비우기
            location.href = 'homepage.html';
        }

        window.onload = render;
    </script>
</body>
</html>