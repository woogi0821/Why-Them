<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.shop.mapper.CartMapper">

    <select id="getCartList" resultType="com.shop.model.CartVO">
        SELECT c.CART_ID              AS cartId,
               c.MEMBER_ID            AS memberId,
               c.PRODUCT_ID           AS productId,
               c.QUANTITY             AS quantity,
               c.SIZE_VAL             AS sizeVal,
               c.CREATED_AT           AS createdAt,
               p.PRODUCT_NAME         AS productName,
               p.PRODUCT_IMAGE        AS productImg,
               p.COLOR_INFO           AS colorInfo,
               p.PRICE                AS price,
               (p.PRICE * c.QUANTITY) AS totalPrice
        FROM CART c
                 JOIN PRODUCT p ON c.PRODUCT_ID = p.PRODUCT_ID
        WHERE c.MEMBER_ID = #{memberId}
        ORDER BY c.CREATED_AT DESC
    </select>

    <update id="updateQuantity">
        UPDATE CART
        SET QUANTITY   = #{quantity},
            UPDATED_AT = SYSDATE
        WHERE CART_ID = #{cartId}
    </update>

    <delete id="deleteCartItem">
        DELETE
        FROM CART
        WHERE CART_ID = #{cartId}
    </delete>

</mapper>