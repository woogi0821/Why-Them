<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.whythem.shop.promotion.mapper.PromotionMapper">

    <!-- ë‹¨ê±´ ì¡°íšŒ -->
    <select id="selectPromotion"
            parameterType="long"
            resultType="Promotion">

        SELECT
        promotion_id,
        promotion_title,
        discount_type,
        discount_value,
        start_date,
        end_date,
        is_active
        FROM promotion
        WHERE promotion_id = #{promotionId}

    </select>


    <!-- ì¢…ë£Œ ì²˜ë¦¬ -->
    <update id="updatePromotionStatus"
            parameterType="long">

        UPDATE promotion
        SET is_active = 'N'
        WHERE promotion_id = #{promotionId}

    </update>


    <!-- ì „ì²´ ê°œìˆ˜ (í˜ì´ì§•ìš©) -->
    <select id="selectPromotionTotalCount"
            parameterType="Criteria"
            resultType="int">

        SELECT COUNT(*)
        FROM promotion
        WHERE 1 = 1

        <if test="searchKeyword != null and searchKeyword != ''">
            AND promotion_title LIKE '%' || #{searchKeyword} || '%'
        </if>

    </select>


    <!-- ëª©ë¡ ì¡°íšŒ (í˜ì´ì§• + ê²€ìƒ‰) -->
    <select id="selectPromotionList" parameterType="Criteria" resultType="Promotion">
        SELECT * FROM promotion
        WHERE 1=1
        <if test="searchKeyword != null and searchKeyword != ''">
            AND promotion_title LIKE '%' || #{searchKeyword} || '%'
        </if>
        -- ğŸ’¡ ì´ ë¶€ë¶„ì´ ìˆì–´ì•¼ ë°©ê¸ˆ ë“±ë¡í•œ í”„ë¡œëª¨ì…˜ì´ 1í˜ì´ì§€ ë§¨ ìœ„ì— ë‚˜ì˜µë‹ˆë‹¤!
        ORDER BY promotion_id DESC
        OFFSET #{offset} ROWS FETCH NEXT #{size} ROWS ONLY
    </select>

    <insert id="insert" parameterType="Promotion">
        INSERT INTO promotion (
        promotion_id,
        promotion_title,
        discount_type,
        discount_value,
        start_date,
        end_date,
        is_active
        ) VALUES (
        promotion_seq.NEXTVAL, -- ì˜¤ë¼í´ ì‹œí€€ìŠ¤ ì‚¬ìš© ì˜ˆì‹œ
        #{promotionTitle},
        #{discountType},
        #{discountValue},
        #{startDate},
        #{endDate},
        'Y' -- ì´ˆê¸° ë“±ë¡ ì‹œ ê¸°ë³¸ê°’ 'Y' (í™œì„±)
        )
    </insert>

</mapper>